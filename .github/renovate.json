{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    ":separateMajorReleases",
    ":combinePatchMinorReleases",
    "helpers:pinGitHubActionDigests"
  ],
  "timezone": "UTC",
  "schedule": ["every weekend"],
  "minimumReleaseAge": "7 days",
  "packageRules": [
    {
      "matchUpdateTypes": ["minor", "patch", "pin", "digest"],
      "automerge": false
    },
    {
      "description": "Ignore major updates for node and python in mise.toml",
      "matchManagers": ["mise"],
      "matchPackageNames": ["node", "python"],
      "matchUpdateTypes": ["major"],
      "enabled": false
    },
    {
      "description": "Do not update sccache",
      "matchPackageNames": ["mozilla/sccache", "sccache"],
      "enabled": false
    },
    {
      "description": "Ignore major updates for @types/node",
      "matchPackageNames": ["@types/node"],
      "matchUpdateTypes": ["major"],
      "enabled": false
    },
    {
      "description": "Group GitHub Actions updates",
      "matchManagers": ["github-actions"],
      "groupName": "GitHub Actions"
    },
    {
      "description": "Group Docker updates",
      "matchManagers": ["dockerfile", "docker-compose"],
      "groupName": "Docker dependencies"
    },
    {
      "description": "Group Rust toolchain updates",
      "matchPackageNames": ["rust", "rustlang/rust"],
      "groupName": "Rust Toolchain"
    }
  ],
  "customManagers": [
    {
      "customType": "regex",
      "managerFilePatterns": ["/^\\.mise-version$/"],
      "matchStrings": ["(?<currentValue>v\\d+\\.\\d+\\.\\d+)"],
      "depNameTemplate": "jdx/mise",
      "datasourceTemplate": "github-releases"
    },
    {
      "customType": "regex",
      "description": "Update Rust nightly toolchain",
      "managerFilePatterns": ["/^rust-toolchain\\.toml$/", "/^mise\\.toml$/"],
      "matchStrings": [
        "(?:channel|rust\\.version)\\s*=\\s*\"(?<currentValue>nightly-\\d{4}-\\d{2}-\\d{2})\""
      ],
      "depNameTemplate": "rustlang/rust",
      "datasourceTemplate": "docker",
      "versioningTemplate": "regex:^(?<compatibility>nightly-)(?<major>\\d{4})-(?<minor>\\d{2})-(?<patch>\\d{2})$"
    },
    {
      "customType": "regex",
      "description": "Update tools in mise.toml using github: shorthand",
      "fileMatch": ["^mise\\.toml$"],
      "matchStrings": [
        "\"github:(?<lookupName>[^/]+/[^\"@/\\s]+)\"\\s*=\\s*\"v?(?<currentValue>[^\"@\\s]+)\"",
        "\\[tools\\.\"github:(?<lookupName>[^/]+/[^\"@/\\s]+)\"\\](?:(?:(?!version_prefix|version\\s*=)[\\s\\S])*?)version\\s*=\\s*\"v?(?<currentValue>[^\"@\\s]+)\""
      ],
      "datasourceTemplate": "github-releases"
    },
    {
      "customType": "regex",
      "description": "Update tools in mise.toml with version_prefix",
      "fileMatch": ["^mise\\.toml$"],
      "matchStrings": [
        "\\[tools\\.\"github:(?<lookupName>[^/]+/[^\"@/\\s]+)\"\\](?:(?:(?!version\\s*=)[\\s\\S])*?)version_prefix\\s*=\\s*\"(?<versionPrefix>.*?)\"(?:(?:(?!version\\s*=)[\\s\\S])*?)version\\s*=\\s*\"(?<currentValue>.*?)\""
      ],
      "datasourceTemplate": "github-releases",
      "extractVersionTemplate": "^{{versionPrefix}}(?<version>.*)$"
    }
  ],
  "pinDigests": true,
  "mise": {
    "enabled": true
  },
  "vulnerabilityAlerts": {
    "enabled": true,
    "addLabels": ["security"]
  }
}
